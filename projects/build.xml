<?xml version="1.0" encoding="UTF-8"?>
<project name="google-enterprise-connector-otex" default="everything" basedir=".">

	<!-- ========================= PROPERTIES ============================= -->
	<property file="version.properties"/>

	<!-- Define Directories. -->
	<property name="otex-core.dir" value="otex-core" />
	<property name="otex-lapi.dir" value="otex-lapi" />
	<property name="install.dir" value="install" />

	<!-- =========================== TASKS =============================== -->

	<target name="clean-all">
		<ant dir="${otex-core.dir}" target="clean" />
		<ant dir="${otex-lapi.dir}" target="clean" />
	</target>

	<target name="prebuild">
		<exec executable="svnversion" spawn="false"
			failifexecutionfails="false"
			dir="${basedir}"
			outputproperty="svnversion">
			<arg line="."/>
		</exec>
	</target>

	<target name="otex-core" depends="prebuild">
		<ant dir="${otex-core.dir}" />
	</target>

	<target name="otex-lapi" depends="otex-core">
		<ant dir="${otex-lapi.dir}" />
	</target>

	<target name="build-all" depends="prebuild,otex-core,otex-lapi"/>

	<target name="make-install-dir">
		<mkdir dir="${install.dir}" />
	</target>

	<target name="install-otex-core" depends="otex-core,make-install-dir">
		<mkdir dir="${install.dir}/otex-core" />
		<copy todir="${install.dir}/otex-core" >
			<fileset dir="${otex-core.dir}/dist"/>
		</copy>
	</target>

	<target name="install-otex-lapi" depends="otex-lapi,make-install-dir">
		<mkdir dir="${install.dir}/otex-lapi" />
		<copy todir="${install.dir}/otex-lapi" >
			<fileset dir="${otex-lapi.dir}/dist"/>
		</copy>
	</target>

	<target name="install-all" 
		depends="prebuild,install-otex-core,install-otex-lapi">
		<property name="archive" value="connector-otex-${version}_en" />
		<zip destfile="${install.dir}/${archive}.zip">
			<zipfileset dir="${install.dir}/otex-lapi/jar" 
				prefix="${archive}" />
			<zipfileset file="../README" prefix="${archive}" />
			<zipfileset file="../RELEASE_NOTES" 
				prefix="${archive}" />
			<zipfileset file="../COPYING" 
				prefix="${archive}/License" />
		</zip>
		<tar destfile="${install.dir}/${archive}.tar.gz" 
			compression="gzip">
			<zipfileset src="${install.dir}/${archive}.zip"/>
                </tar>
	</target>

	<target name="everything" depends="clean-all,build-all,install-all"/>

</project>
